#!/bin/bash
# Search Exploits

####################
# Global variables #
####################

DEPENDENCIES="searchsploit"

myVULNFILE="../src/vuln-findings.xml"
myEXPLOITFILE="output/exploit-findings.json"

################################
# Installation of Dependencies #
################################

#fuGET_DEPS

###########################
# Create output directory #
###########################

if [ ! -d "output/" ]; then
  fuINFO "creating \"output/\" directory"
  mkdir output && echo "[ OK ]"
fi

###################
# Search Exploits #
###################

# searchsploit
# update exploitdb
fuTITLE "Update exploitdb ..."
sleep 2
if fuCHECK_INET; then
  searchsploit -u
else
  fuERROR "Exploitdb cannot be updated."
fi

# search through exploits and shellcodes from nmap vulners scan
fuTITLE "Search exploits from Nmap vulnerability findings ..."
sleep 3
if [ -s "$myVULNFILE" ]; then
  searchsploit --nmap $myVULNFILE --color -p | tee $myEXPLOITFILE
else
  fuERROR "File $myVULNFILE not found, check vulnerability scanning from reconnaissance phase"
fi

#####################
# Summarize Results #
#####################

fuTITLE "Findings in following files:"
if [ -s "$myEXPLOITFILE" ]; then
  fuRESULT "Exploits found in: $myEXPLOITFILE"
else
  fuERROR "No exploits found"
fi
echo