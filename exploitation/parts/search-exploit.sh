#!/bin/bash
# Search Exploits

####################
# Global variables #
####################

DEPENDENCIES="searchsploit"

myVULNFILE="../src/vuln-findings.xml"
myEXPLOITFILE="output/exploit-findings.json"


################################
# Installation of Dependencies #
################################

if [ "$IAMROOT" ] && [ "$INET" ]; then
  install_deps
else
  print_message "Installation of dependencies skipped."
fi


###########################
# Create output directory #
###########################

if [ ! -d "output/" ]; then
  print_info "creating \"output/\" directory"
  mkdir output && echo "[ OK ]"
fi


###################
# Search Exploits #
###################

# searchsploit
# update exploitdb
print_title "Update exploitdb ..."
sleep 2
if [ "$INET" ]; then
  searchsploit -u
else
  print_error "Exploitdb cannot be updated."
fi

# search through exploits and shellcodes from nmap vulners scan
print_title "Search exploits from Nmap vulnerability findings ..."
sleep 3
if [ -s "$myVULNFILE" ]; then
  searchsploit --nmap $myVULNFILE --color -p | tee $myEXPLOITFILE
else
  print_error "File $myVULNFILE not found, check vulnerability scanning from reconnaissance phase"
fi


#####################
# Summarize Results #
#####################

print_title "Findings in following files:"

if [ -s "$myEXPLOITFILE" ]; then
  print_result "Exploits found in: $myEXPLOITFILE"
else
  print_error "No exploits found"
fi
echo